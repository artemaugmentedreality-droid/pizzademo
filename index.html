<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Rasca y Gana - Pizza Tutti</title>
    <link rel="icon" type="image/webp" href="favicon.webp">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-dark: #0a0a0a;
            --card-bg: #1a1a1a;
            --accent-white: #ffffff;
        }

        body { 
            margin: 0; padding: 0; 
            /* Nombre exacto del archivo de fondo con espacios y paréntesis */
            background: var(--bg-dark) url('Fondo-01 (Copy).webp') center center fixed;
            background-size: cover;
            font-family: 'Montserrat', sans-serif; 
            color: var(--accent-white);
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
        }

        .header-logo { 
            margin-top: 30px; 
            margin-bottom: 10px;
            width: 100%;
            display: flex;
            justify-content: center;
        }
        
        .header-logo img { 
            width: 180px; /* Ajustado para que no ocupe tanto espacio */
            height: auto;
        }

        .container { 
            width: 90%; 
            max-width: 400px; 
            text-align: center; 
        }

        h1 { 
            font-size: 22px; 
            font-weight: 900; 
            margin: 10px 0; 
            text-transform: uppercase; 
        }

        .banner-instrucciones {
            background-color: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 15px;
            font-size: 14px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
        }

        .grid-rasca {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .casilla {
            position: relative;
            aspect-ratio: 1/1;
            background: var(--card-bg);
            border-radius: 10px;
            overflow: hidden;
        }

        .casilla img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
        }

        canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            touch-action: none;
            z-index: 2;
        }

        .btn-cta {
            background: var(--accent-white);
            color: #000;
            border: none;
            padding: 14px 25px;
            border-radius: 50px;
            font-weight: 900;
            margin-top: 20px;
            cursor: pointer;
            text-transform: uppercase;
        }

        /* Modal y Overlay */
        .overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; flex-direction: column; justify-content: center; align-items: center; }
        .modal { background: #fff; color: #000; padding: 30px 20px; border-radius: 25px; width: 80%; max-width: 320px; text-align: center; }
        .premio-final-img { width: 120px; border-radius: 10px; margin-bottom: 15px; }
    </style>
</head>
<body>

    <div class="header-logo">
        <img src="logotipo.webp" alt="Pizza Tutti">
    </div>

    <div class="container">
        <h1>¡RASCA Y GANA!</h1>
        <div class="banner-instrucciones">
            Encuentra 3 premios iguales para ganar.<br><strong>¡Suerte!</strong>
        </div>
        
        <div class="grid-rasca" id="grid-principal"></div>
        
        <button class="btn-cta" onclick="location.reload()">PROBAR DE NUEVO</button>
    </div>

    <div id="modal-ganador" class="overlay">
        <div class="modal">
            <h2 id="titulo-modal" style="margin: 0;">¡FELICIDADES!</h2>
            <p id="texto-intro">Tu premio es:</p>
            <img id="img-premio-modal" src="" class="premio-final-img">
            <h3 id="nombre-premio" style="margin: 0 0 20px 0;"></h3>
            
            <button class="btn-cta" style="background: #25D366; color: white; width: 100%;" onclick="reclamarPremio()">
                RECLAMAR PREMIO
            </button>
            <p style="font-size: 10px; color: #666; margin-top: 15px;">*Aplican restricciones según bases en sucursal.</p>
        </div>
    </div>

    <script>
        // Definición de premios usando tus archivos exactos
        // Para el archivo 10%1.webp usamos el escape %25 para que el navegador lo encuentre
        const PREMIOS_DATA = [
            { id: '2x1', nombre: '2x1 en Pizzas Martes', base: '2x1-' },
            { id: '10por', nombre: '10% de Descuento', base: '10%25' },
            { id: 'desc20', nombre: '$20 MXN de Descuento', base: 'descuento20-' },
            { id: 'papas', nombre: 'Papas Gratis', base: 'porciondepapas' },
            { id: 'postre', nombre: 'Postre de Cortesía', base: 'postre' },
            { id: 'refresco', nombre: 'Bebida de Regalo', base: 'refresco' },
            { id: 'nada', nombre: 'Sigue Participando', base: 'sinpremio' }
        ];

        let ganadorActual = null;
        let casillasReveladas = new Set();
        const TOTAL_CASILLAS = 9;

        function inicializarJuego() {
            const grid = document.getElementById('grid-principal');
            ganadorActual = PREMIOS_DATA[Math.floor(Math.random() * PREMIOS_DATA.length)];
            
            // Creamos el mazo con 3 del ganador y el resto aleatorios
            let mazo = [
                {...ganadorActual, img: `${ganadorActual.base}1.webp`},
                {...ganadorActual, img: `${ganadorActual.base}2.webp`},
                {...ganadorActual, img: `${ganadorActual.base}3.webp`}
            ];

            let otros = PREMIOS_DATA.filter(p => p.id !== ganadorActual.id);
            otros.sort(() => 0.5 - Math.random());

            // Llenamos con parejas de otros premios para que haya variedad
            for(let i=0; i<3; i++) {
                mazo.push({ ...otros[i], img: `${otros[i].base}1.webp` });
                mazo.push({ ...otros[i], img: `${otros[i].base}2.webp` });
            }

            mazo.sort(() => 0.5 - Math.random());

            mazo.forEach((item, i) => {
                const div = document.createElement('div');
                div.className = 'casilla';
                div.innerHTML = `<img src="${item.img}"><canvas id="canvas${i}"></canvas>`;
                grid.appendChild(div);
                setupCanvas(i);
            });
        }

        function setupCanvas(i) {
            const canvas = document.getElementById(`canvas${i}`);
            const ctx = canvas.getContext('2d');
            const imgTapa = new Image();
            imgTapa.src = 'tapa.webp'; // Tu archivo de capa superior

            imgTapa.onload = () => {
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
                ctx.drawImage(imgTapa, 0, 0, canvas.width, canvas.height);
            };

            let raspando = false;
            const rascar = (e) => {
                if (!raspando) return;
                const rect = canvas.getBoundingClientRect();
                const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
                const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
                ctx.globalCompositeOperation = 'destination-out';
                ctx.beginPath();
                ctx.arc(x, y, 20, 0, Math.PI * 2);
                ctx.fill();
                verificarRaspado(canvas, i);
            };

            canvas.addEventListener('mousedown', () => raspando = true);
            canvas.addEventListener('touchstart', () => raspando = true);
            window.addEventListener('mouseup', () => raspando = false);
            window.addEventListener('touchend', () => raspando = false);
            canvas.addEventListener('mousemove', rascar);
            canvas.addEventListener('touchmove', (e) => { e.preventDefault(); rascar(e); });
        }

        function verificarRaspado(canvas, i) {
            if (casillasReveladas.has(i)) return;
            const ctx = canvas.getContext('2d');
            const pixeles = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
            let transparentes = 0;
            for (let j = 3; j < pixeles.length; j += 4) {
                if (pixeles[j] === 0) transparentes++;
            }

            if (transparentes > (pixeles.length / 4) * 0.5) {
                casillasReveladas.add(i);
                canvas.style.opacity = "0";
                canvas.style.transition = "opacity 0.5s";
                if (casillasReveladas.size === TOTAL_CASILLAS) setTimeout(mostrarResultado, 500);
            }
        }

        function mostrarResultado() {
            const modal = document.getElementById('modal-ganador');
            if(ganadorActual.id === 'nada') {
                document.getElementById('titulo-modal').innerText = "¡SUERTE PARA LA PRÓXIMA!";
                document.getElementById('texto-intro').innerText = "No ganaste esta vez, pero vuelve pronto.";
            }
            document.getElementById('nombre-premio').innerText = ganadorActual.nombre;
            document.getElementById('img-premio-modal').src = `${ganadorActual.base}1.webp`;
            modal.style.display = 'flex';
        }

        function reclamarPremio() {
            const num = "5215542492026";
            const msg = encodeURIComponent(`¡Hola! Gané "${ganadorActual.nombre}" en el Rasca y Gana de Pizza Tutti. ¿Cómo lo canjeo?`);
            window.open(`https://wa.me/${num}?text=${msg}`, '_blank');
        }

        window.onload = inicializarJuego;
    </script>
</body>
</html>
